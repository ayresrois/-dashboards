CREATE OR REPLACE PROCEDURE STP_INC_INFO_BENS
AS
BEGIN
/* CRIADA POR AYRES RODRIGUES - SQA - 18/04/2022
/* INSERT NA TCICTA, INFORMAÇÕES DE CONTAS CONTABEIS */

FOR I IN (
		  SELECT PRO.CODGRUPOPROD, PRO.CODPROD
                , GRU.AD_CODCTADEBDEP
                , GRU.AD_CODCTACREDEP 
                , GRU.AD_CODCTADEBBAI 
                , GRU.AD_CODCTACREBAI 
                , GRU.AD_CODCTADEBBAIDEP 
                , GRU.AD_CODCTACREBAIDEP 
                , BEM.CODBEM
            FROM TGFPRO PRO INNER JOIN TCIBEM BEM ON PRO.CODPROD = BEM.CODPROD
                            INNER JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
            WHERE PRO.USOPROD = 'I'
                    AND NOT EXISTS (SELECT * FROM TCICTA CTA WHERE CTA.CODPROD = PRO.CODPROD)
		)
LOOP
    BEGIN
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, 'D', I.CODBEM, I.AD_CODCTADEBDEP, 14) ;
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, 'E', I.CODBEM, I.AD_CODCTACREDEP, 14) ;
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, 'X', I.CODBEM, I.AD_CODCTADEBBAIDEP, 15) ;
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, 'B', I.CODBEM, I.AD_CODCTACREBAIDEP, 15) ;
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, '1', I.CODBEM, I.AD_CODCTADEBBAI , 16) ;
        INSERT INTO TCICTA (CODPROD, TIPO, CODBEM, CODCTACTB, CODHISTCT) VALUES ( I.CODPROD, '2', I.CODBEM, I.AD_CODCTACREBAIDEP , 16) ;
    END;
    
END LOOP;

/* INSERT NA TCITAX, TAXAS DE DPRECIAÇÃO */
FOR J IN (
		SELECT PRO.CODGRUPOPROD,PRO.CODPROD
               , GRU.AD_TAXA
               , BEM.CODBEM
        FROM TGFPRO PRO INNER JOIN TCIBEM BEM ON PRO.CODPROD = BEM.CODPROD
                        INNER JOIN TGFGRU GRU ON PRO.CODGRUPOPROD = GRU.CODGRUPOPROD
        WHERE PRO.USOPROD = 'I'
                AND NOT EXISTS (SELECT * FROM TCITAX TAX WHERE TAX.CODPROD = PRO.CODPROD)
		)
LOOP
     INSERT INTO TCITAX (CODPROD, CODBEM, DTINICIO, TAXA) VALUES (J.CODPROD, J.CODBEM, '01/01/2021', J.TAXA);
    
END LOOP;

END;