CREATE OR REPLACE TRIGGER SQA_TRG_DLT_AD_APDESPMOV AFTER
    DELETE ON AD_APDESPMOV
    FOR EACH ROW
DECLARE
    PRAGMA AUTONOMOUS_TRANSACTION;
    P_COUNT INT;
    ERROR EXCEPTION;
    ERRMSG  VARCHAR2(255);
BEGIN

 /* TRIGGER CRIADA PARA ATUALIZAR VALOR AMORTIZADO APÓS EXCLUSÃO
 CRIADA POR AYRES RODRIGUES - SQA 29/03/2022 */


    IF STP_GET_ATUALIZANDO THEN
        RETURN;
    END IF;
    SELECT
        COUNT(*)
    INTO P_COUNT
    FROM
        TCBLAN
    WHERE
            NUMLOTE = 33333
        AND TRUNC(REFERENCIA) = :OLD.REFERENCIA
        AND CODCENCUS = :OLD.CODCENCUS;

    IF ( P_COUNT > 0 ) THEN
        RAISE_APPLICATION_ERROR(-20000, 'Não é possível excluir esta movimentação. Movimentação gerou lote contábil.');
    END IF;
END;
/