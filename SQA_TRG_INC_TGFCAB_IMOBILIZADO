CREATE OR REPLACE TRIGGER SQA_TRG_INC_TGFCAB_IMOBILIZADO BEFORE
    INSERT ON TGFCAB
    FOR EACH ROW
DECLARE
    PRAGMA AUTONOMOUS_TRANSACTION;
    P_CODPROJ NUMBER; 
    P_CODNAT NUMBER;
    P_TIPMOV  VARCHAR(2);

    ERROR EXCEPTION;
    ERRMSG  VARCHAR2(255);
BEGIN

 /* TRIGGER CRIADA PARA VERIFICAR SE PROJETO ESTÁ PREENCHIDO
 CRIADA POR AYRES RODRIGUES - SQA 19/04/2022 */


    IF STP_GET_ATUALIZANDO THEN
        RETURN;
    END IF;
    
    P_CODPROJ := :NEW.CODPROJ;
    P_CODNAT  := :NEW.CODNAT;
    P_TIPMOV  := :NEW.TIPMOV;

    IF ( P_CODPROJ = 0 AND P_CODNAT = 99050108 AND  P_TIPMOV = 'O' ) THEN
        RAISE_APPLICATION_ERROR(-20000, 'Não é permitido inserir pedido com a natureza de "IMOBILIZADO EM ANDAMENTO" sem informar Projeto.');
    END IF;
END;
/
